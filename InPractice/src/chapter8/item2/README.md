## 设置线程池的大小 ##

线程池的理想大小取决于被提交任务的类型以及所部署系统的特性。在代码中通常不会固定线程池的大小，而应该通过某种配置机制来提供，或者根据 Runtime.availableProcessors 来动态计算。

要正确地设置线程池的大小，必须分析计算环境、资源预算和任务的特殊性。在部署的系统中有多少个 CPU？多大的内存？任务是计算密集型还是 I/O 密集型？它们是否需要像 JDBC 连接这样的稀缺资源？
如果需要执行不同类别的任务，并且它们之间的行为相差很大，那么应该考虑使用多个线程池，从而使每个线程池可以根据各自的工作负载来调整。

对于计算密集型的任务，在拥有 N_cpu 个处理器的系统上，当线程池的大小为 N_cpu + 1 时，通常能实现最优的利用率。
对于包含 I/O 操作或者其他阻塞操作的任务，由于线程并不会一直执行，因此线程池的规模应该更大。要正确地设置线程池的大小，必须估算出任务的等待时间和计算时间的比值。这种估算不需要很精确，可以通过分析或者监控工具来获得。

当任务需要某种通过资源池来管理的资源时，例如数据库连接，那么线程池和资源池的大小将会相互影响。如果每个任务都需要一个数据库连接，那么连接池的大小就限制了线程池的大小。同样，当线程池中的任务是数据库连接的唯一使用者时，线程池的大小又将限制连接池的大小。
