## 线程安全性 ##

要编写线程安全的代码，其核心在于要对状态访问操作进行管理，特别是对共享的和可变的状态的访问。

对象的状态是指存储在状态变量（例如实例或静态域）中的数据。对象的状态可能包括其他依赖的对象的域。“共享”意味着变量可以由多个线程同时访问，而“可变”则意味着变量的值在其生命周期内可以发生变化。

一个对象是否需要线程安全的，取决于它是否被多个线程访问。这指的是在程序中访问对象的方式，而不是对象要实现的功能。要使得对象是线程安全的，需要采用同步机制来协同对对象可变状态的访问。当多个线程访问某个状态变量并且其中一个线程执行写入操作时，必须采用同步机制来协同这些线程对变量的访问。Java 中的主要同步机制是关键字 synchronized，它提供了一种独占的加锁方式，还包括 volatile 类型的变量，显示锁（Explicit Lock）以及原子变量。

当多个线程访问同一个可变的状态变量时没有使用合适的同步，那么程序就会出现错误，有以下三种方式可以修复：

* 1，不在线程之间共享该状态变量。
* 2，将状态变量修改为不可变的变量。
* 3，在访问状态变量时使用同步。

面向对象技术不仅有助于编写出结构优雅、可维护性高的类，还有有助于编写出线程安全的类。程序状态的封装性越好，越容易实现程序的线程安全性，并且代码的可维护性越高。

在任何情况下，只有当类中仅包含自己的状态时，线程安全类才是有意义的。线程安全性是一个在代码上使用的术语，但它只是与状态相关的，因此只能应用于封装其状态的整个代码，这可能是一个对象，也可能是整个程序。


当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。在线程安全类的对象实例上执行的任何串行或并行操作都不会使对象处于无效状态。因为在线程安全类中封装了必要的同步机制，所以客户端无需进一步采取同步措施。