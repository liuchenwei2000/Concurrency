## 对象的共享 ##

本章主要介绍如何共享和发布对象，从而使它们能够安全地由多个线程同时访问。

同步代码块和同步方法可以确保以原子的方式执行操作，但一种常见的误解是：关键字 synchronized 只能用于实现原子性或者确定临界区（Critical Section）。同步还有另一个重要的方面：内存可见性。我们不仅希望防止某个线程正在使用对象状态而另一个线程在同时修改该状态，而且希望确保当一个线程修改了对象状态后，其他线程能够看到发生的状态变化。如果没有同步，那么这种情况就无法实现。可以通过显式的同步或者类库中内置的同步来保证对象被安全地发布。

### 小结

在并发程序中使用和共享对象时，可以使用一些实用的策略，包括：

* **线程封闭** 线程封闭的对象只能由一个线程拥有，对象被封闭在该线程中，并且只能由这个线程修改。
* **只读共享** 在没有额外同步的情况下，共享的只读对象可以由多个线程并发访问，但任何线程都不能修改它。共享的只读对象包括不可变对象和事实不可变对象。
* **线程安全共享** 线程安全的对象在其内部实现同步，因此多个线程可以通过对象的公有接口来进行访问而不需要进一步的同步。
* **保护对象** 被保护的对象只能通过持有特定的锁来访问。保护对象包括封装在其他线程安全对象中的对象，以及已发布的并且由某个特定锁保护的对象。